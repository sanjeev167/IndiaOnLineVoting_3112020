/**
 * 
 */
package com.pon.web.user.pub.en.service;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.core.userdetails.User.UserBuilder;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import com.pon.web.user.pub.en.entity.WebUser;
import com.pon.web.user.pub.en.repo.WebUserRepository;
import com.support.config.security.voter.DynamicMethodAccessVoter;


/**
 * @author Sanjeev
 *
 */

@Service
public class CustomWebUserDetailsServiceImpl implements UserDetailsService {
	private static final Logger log=LoggerFactory.getLogger(CustomWebUserDetailsServiceImpl.class);
	    @Autowired
	    private WebUserRepository webUserRepository;
	    
	    @Transactional
	    @Override
	    public UserDetails loadUserByUsername(String email) {		    	
	    	UserBuilder builder = null;
	    	try {	      
	       WebUser webUser = webUserRepository.findByEmail(email).get();     
	        CustomWebUserDetailsImpl customUserDetailsImpl=new CustomWebUserDetailsImpl();	      
	        log.info("Sanjeev = "+new BCryptPasswordEncoder().encode(webUser.getPassword()));
	        if (webUser != null) {	        	
	          builder = org.springframework.security.core.userdetails.User.withUsername(email);
	          builder.password(new BCryptPasswordEncoder().encode(webUser.getPassword()));          
	          builder.authorities(customUserDetailsImpl.getAuthorities(webUser));	        
	        }
	    	}catch(Exception ex) {ex.printStackTrace();}
	        return builder.build();
	        
	    }

	


}